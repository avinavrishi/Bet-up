<!DOCTYPE html>
<html lang="en">

{% load static %}

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>{% block title %} {% endblock%}</title>

    <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
    integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>

    <link rel="stylesheet" href="{% static 'css/themify-icons.css' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
 <style>

body{
  z-index: 0;
}
h2,h3 {
  text-align: center;
  font-size: 80px;
  margin-top: 0px;
}

.headerBal{
  background-color: lightblue;
  padding: 10px;
}

.headerGameSec{
  background-color: whitesmoke;
  border: 1px solid gray;
  padding: 10px;
}

.headerGameArea{
  background-color:#f2edd8;
  padding: 10px;
}
</style>


</head>

<body class="color-theme-blue">
    {% block body %}
    {% endblock body %}

    {% block content %}
    {% endblock %}

    {% block rechargePage %}
    {% endblock %}
    <script src="{% static 'js/plugin.js' %}"></script>
    <script src="{% static 'js/scripts.js' %}"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns"
    crossorigin="anonymous"></script>


    
    {% if user.is_authenticated %}
<script>

    document.getElementById("period").innerHTML = generateLotteryNumber();
    startTime();

  function generateLotteryNumber(){
      const today = new Date();
      let year = today.getFullYear();
      let dat = today.getDate();
      let mon = today.getMonth();
      let h = today.getHours();
      totalMinutePassedCounter = parseInt(((h * 60)+ today.getMinutes())/3);
      lotteryNum = parseInt(year+""+(mon)+""+dat+""+totalMinutePassedCounter);
      return lotteryNum;
  }

  


//----------------------------------Timer Block--------------------------
function startTime() {
  const today = new Date();
  let h = today.getHours();
  let m = 2 - (today.getMinutes() % 3);
  let s = 60 - today.getSeconds();
  m = checkTime(m);
  s = checkTime(s);
  document.getElementById('timer').innerHTML =  m + ":" + s;
 
 
  if(m == 2 && s == 60){
    window.location.href = '{% url 'home' %}';

  }
  else if (m == 0 && s == 5){
    findResult();
  }

  setTimeout(startTime, 1000);
}
  function checkTime(i) {
  if (i < 10) {i = "0" + i};  // add zero in front of numbers < 10
  return i;
}



function findResult(){
  lotteryNum = generateLotteryNumber();
 
  mydata = {csrfmiddlewaretoken: '{{ csrf_token }}',lotnum: lotteryNum}

  $.ajax({

    url:"{% url 'result' %}",
    method: "POST",
    data: mydata,
    success: function(data){
      console.log(data)
    },

  });

}
</script>






<script>
    
    $(document).ready(function(){
      let color = "none";
      let bl = $('#bal').html().split(" ");
      let balance = parseInt(bl[3]);
     
      $(".btn").click(function(){

        val = $(this).text()
        

        

        
        if(val == "Join Red"){
          $("#betForm").show();
          $("#colorHeadBanner").css({"background-color": "Red"});
          $("#colorHead").html('Join Red');
          color = "Red";


        }
        else if(val == "Join Green"){
          $("#betForm").show();
          $("#colorHeadBanner").css({"background-color": "Green"});
          $("#colorHead").html('Join Green');
          color= "Green";
        }
        else if(val == "Join Blue"){
          $("#betForm").show();
          $("#colorHeadBanner").css({"background-color": "Lightblue"});
          $("#colorHead").html('Join Blue');
          color = "Blue";
        }
        else if(val == "Close"){
          $("#betForm").hide();
        }
        else if(val == "Submit"){
          let amount = parseInt($("#amount").val());
          

              if (amount <= balance){
                if(amount != "" && amount >= 10){
                  $("#betForm").hide();
                  lotteryNum = generateLotteryNumber();
                  myBetData = {csrfmiddlewaretoken: '{{ csrf_token }}', Amount: amount, Color : color, LotteryNum: lotteryNum }

                  $.ajax({

                      url:"{% url 'gameView' %}",
                      method: "POST",
                      data: myBetData,
                      success: function(data){
                        console.log(data)
                        $("form")[0].reset();
                      },

                    });
                  }
                  else{
                    console.log("Please enter value greater than 10");
                  }
              }
              else{
                console.log("Recharge more");
            }    
        }else if(val == "Recharge"){
          window.location.href = '{% url 'rechargePage' %}';
        }

      });  
    });

     function closeBetForm(){
      document.getElementById('betForm').style.display ="none";
     }


</script>
{% endif %}

</body>


</html>